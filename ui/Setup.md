# TradingLab UI & API Gateway

This is the user interface and API gateway for the TradingLab service. The UI visualizes trading signals, backtest results, and options recommendations generated by the TradingLab gRPC service.

## Architecture

The TradingLab UI consists of two main components:

1. **API Gateway**: A Flask service that translates RESTful API requests to gRPC calls to the TradingLab service
2. **React UI**: A single-page web application that provides visualizations and user-friendly interfaces

## Local Development

### API Gateway

1. Create a virtual environment:
```bash
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate
```

2. Install dependencies:
```bash
cd gateway
pip install -r requirements.txt
```

3. Start the API Gateway:
```bash
python app.py
```

The API Gateway will be available at http://localhost:5000

### React UI

1. Install dependencies:
```bash
cd ui
npm install
```

2. Start the development server:
```bash
npm start
```

The UI will be available at http://localhost:3000 and will proxy API requests to the API Gateway.

## Docker Build

1. Build the API Gateway:
```bash
docker build -t tradinglab-api-gateway:latest -f gateway/Dockerfile .
```

2. Build the UI:
```bash
docker build -t tradinglab-ui:latest -f ui/Dockerfile .
```

3. Run containers:
```bash
# Run API Gateway
docker run -p 5000:5000 \
  -e TRADINGLAB_HOST=host.docker.internal \
  -e TRADINGLAB_PORT=50052 \
  tradinglab-api-gateway:latest

# Run UI
docker run -p 80:80 tradinglab-ui:latest
```

## Kubernetes Deployment

### Prerequisites

- A Kubernetes cluster
- kubectl configured to access your cluster
- An Artifact Registry repository for your Docker images

### Deploy to Kubernetes

1. Update image registry URL in Kubernetes YAML files:
```bash
export REGISTRY_URL="us-central1-docker.pkg.dev/your-project-id/your-repo"
sed -i "s|\${REGISTRY_URL}|${REGISTRY_URL}|g" kube/api-gateway-deployment.yaml
sed -i "s|\${REGISTRY_URL}|${REGISTRY_URL}|g" kube/ui-deployment.yaml
```

2. Deploy the API Gateway:
```bash
kubectl apply -f kube/api-gateway-deployment.yaml
```

3. Deploy the UI:
```bash
kubectl apply -f kube/ui-deployment.yaml
```

4. Apply Horizontal Pod Autoscaler:
```bash
kubectl apply -f kube/hpa.yaml
```

5. Verify the deployments:
```bash
kubectl get deployments
kubectl get services
kubectl get hpa
```

## Continuous Integration/Deployment with Cloud Build

1. Create a Cloud Build trigger with the following settings:
    - Repository: Your source code repository
    - Branch: `^main$` (or your preferred branch)
    - Build configuration: `cloudbuild-ui.yaml`

2. Push changes to your repository to trigger the build and deployment.

## Access the UI

After deployment, the UI will be accessible via the LoadBalancer service IP assigned to the tradinglab-ui service:

```bash
kubectl get service tradinglab-ui -o jsonpath='{.status.loadBalancer.ingress[0].ip}'
```

## Troubleshooting

### API Gateway Troubleshooting

1. Check logs:
```bash
kubectl logs -l app=api-gateway
```

2. Check if API Gateway can reach TradingLab service:
```bash
kubectl exec -it $(kubectl get pod -l app=api-gateway -o jsonpath='{.items[0].metadata.name}') -- curl tradinglab-service:50052
```

### UI Troubleshooting

1. Check logs:
```bash
kubectl logs -l app=tradinglab-ui
```

2. Check if UI can reach API Gateway:
```bash
kubectl exec -it $(kubectl get pod -l app=tradinglab-ui -o jsonpath='{.items[0].metadata.name}') -- curl api-gateway:5000/api/health
```

## Security Considerations

For production deployments, consider the following security enhancements:

1. Setup TLS with a certificate for your domain
2. Implement authentication for the API Gateway
3. Configure network policies to restrict traffic between pods
4. Use Kubernetes Secrets for configuration instead of environment variables